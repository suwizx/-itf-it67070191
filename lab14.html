<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>I'am IT67070191</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstptic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body class="bg-zinc-900 text-white min-w-screen min-h-screen p-4 w-screen">
    <nav class="px-4 py-4 border w-full gap-12 border border-zinc-700 my-2 rounded-lg flex justify-between items-center overflow-y-auto text-nowrap">
        <a href="/" class="text-2xl font-medium">I'am IT67070191</a>
        <div class="flex gap-4 items-center">
            <a href="./lab14.html" class="bg-transparent py-2 px-4 rounded-lg hover:scale-95 transition scale-100 hover:text-blue-600 ">Lab 14</a>
            <a href="https://suwizx.dev/me" class="bg-blue-600 py-2 px-4 rounded-lg hover:scale-95 transition scale-100 hover:bg-blue-700 ">About Me</a>
        </div>
    </nav>
    <div class="my-10 flex flex-wrap justify-center">
        <h1 class="font-medium text-2xl mb-4 text-center">
            My
            <span id="displayName">Suwizx</span>
            's Phone Book
        </h1>
        <div class="w-full mb-4">
            <div class="w-full">
                <div class="w-[183px] h-[183px] block mx-auto relative">
                    <img id="imgDisplay" src="https://uploads.dailydot.com/2018/10/olli-the-polite-cat.jpg?q=65&auto=format&w=1600&ar=2:1&fit=crop" alt="User Profile" class="w-[183px] h-[183px] aspect-square object-cover  rounded-full absolute">
                    <div class="absolute right-0 bottom-0">
                        <div class="bg-blue-600 px-4 py-2 rounded-full" id="numberDisplay">
                            3000
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="border border-zinc-600 rounded-lg p-4 max-w-2xl w-full mb-4">
            <div class="flex gap-4 mb-2">
                <input type="text" id="nameInput" class="w-full px-4 py-2 rounded-lg border outline-none focus:outline-blue-500 border-zinc-600 bg-transparent" placeholder="Enter Username">
                <button onclick="setUsername(event)" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">SET</button>
            </div>
            <div class="flex gap-4">
                <input type="text" id="imgInput" class="w-full px-4 py-2 rounded-lg border outline-none focus:outline-blue-500 border-zinc-600 bg-transparent" placeholder="Enter Image URL">
                <button onclick="setImageURL(event)" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">SET</button>
            </div>
        </div>
        <div class="border border-zinc-600 rounded-lg p-4 max-w-2xl w-full mb-4">
            <div class="flex flex-wrap md:flex-nowrap gap-4 pb-4 border-b border-zinc-600 mb-2">
                <input type="text" id="nameAddInput" class="w-full px-4 py-2 rounded-lg border outline-none focus:outline-blue-500 border-zinc-600 bg-transparent" placeholder="Enter Name">
                <input type="text" id="telAddInput" class="w-full px-4 py-2 rounded-lg border outline-none focus:outline-blue-500 border-zinc-600 bg-transparent" placeholder="Enter Tel">
                <div class="gap-4 flex flex-nowrap">
                    <button onclick="addPhone(event)" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">ADD</button>
                    <button onclick="saveCsvFile(event)" class="bg-blue-600 px-4 py-2 rounded-lg hover:bg-blue-700 transition">EXPORT</button>
                </div>
            </div>
            <div class="bg-zinc-800 rounded-lg overflow-y-auto text-nowrap">
                <table class="w-full">
                    <thead class="w-full">
                        <tr class="w-full">
                            <th class="font-medium text-start py-2 px-4 bg-zinc-700 rounded-l-lg">
                                No
                            </th>
                            <th class="font-medium text-start py-2 px-4 bg-zinc-700">
                                Name
                            </th>
                            <th class="font-medium text-end py-2 px-4 bg-zinc-700 rounded-r-lg">
                                Tel
                            </th>
                        </tr>
                    </thead>
                    <tbody id="phoneListDisplay">
                        <tr class="hover:bg-zinc-900">
                            <td class="py-2 px-4 border-zinc-600">
                                1
                            </td>
                            <td class="py-2 px-4 border-zinc-600">
                                Suwizx
                            </td>
                            <td class="py-2 px-4 border-zinc-600 text-end">
                                0812345678
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    <footer class="py-2 text-center fixed bottom-0 left-0 w-full border-t border-zinc-600 bg-zinc-950">
        <p>THIS WEBSITE MADE FOR ITF | suwizx.dev</p>
    </footer>
</body>
<script>

    let phoneList = [
        {
            name: "Suwijak Promsatid",
            tel: "0924596451"
        },
    ]

    let name = "Suwizx"
    let imageURL = "https://uploads.dailydot.com/2018/10/olli-the-polite-cat.jpg?q=65&auto=format&w=1600&ar=2:1&fit=crop"
    

    nameInput.value = name
    imgInput.value = imageURL
    numberDisplay.innerText = phoneList.length

    renderPhone()

    function renderPhone(){
        phoneListDisplay.innerHTML = phoneList.map((phone, index) => {
            return `
                <tr class="hover:bg-zinc-900">
                    <td class="py-2 px-4 border-zinc-600">
                        ${index + 1}
                    </td>
                    <td class="py-2 px-4 border-zinc-600">
                        ${phone.name}
                    </td>
                    <td class="py-2 px-4 border-zinc-600 text-end">
                        ${phone.tel}
                    </td>
                </tr>
            `
        }).join("")
    }

    function addPhone(e) {
        e.preventDefault()
        let name = nameAddInput.value
        let tel = telAddInput.value

        if (name === "") {
            alert("Please enter name")
            return
        }
        if (tel === "") {
            alert("Please enter calling number")
            return
        }

        phoneList.push({
            name: name,
            tel: tel
        })

        numberDisplay.innerText = phoneList.length
        renderPhone()
    }

    function setUsername(e){
        e.preventDefault()
        name = nameInput.value
        displayName.innerText = name
    }

    function setImageURL(e){
        e.preventDefault()
        imageURL = imgInput.value
        imgDisplay.setAttribute("src", imageURL)
    }

    function jsonToCsv(jsonData) {
        const headers = Object.keys(jsonData[0]);
        const csvRows = [];

        // Add BOM for UTF-8
        csvRows.push('\ufeff');

        // Add header row
        csvRows.push(headers.join(','));

        // Add data rows
        for (const row of jsonData) {
            const values = headers.map(header => {
                const cellValue = row[header] === null || row[header] === undefined ? '' : row[header].toString();
                // Escape quotes and wrap in quotes if the value contains comma or newline
                const escaped = cellValue.replace(/"/g, '""');
                return `"${escaped}"`;
            });
            csvRows.push(values.join(','));
        }

        return csvRows.join('\n');
    }

    function saveCsvFile(e) {
        e.preventDefault()
        const csvContent = jsonToCsv(phoneList);
        const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
        
        if (navigator.msSaveBlob) { // IE 10+
            navigator.msSaveBlob(blob, "phonebook.csv");
        } else {
            const link = document.createElement('a');
            if (link.download !== undefined) {
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', 'phonebook.csv');
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
        }
    }

</script>
</html>